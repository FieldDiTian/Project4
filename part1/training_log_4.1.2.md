# 任务 4.1.2 训练日志与结果分析

## 任务概述

本任务要求复制任务 4.1.1 的代码，并修改神经网络架构：
- **任务 4.1.1**: 使用 3 个隐藏层（8、14、8 神经元）
- **任务 4.1.2**: 使用 4 个隐藏层（6、9、13、7 神经元）

## 模型架构对比

### 任务 4.1.1
```
输入层(6) → 隐藏层(8) → 隐藏层(14) → 隐藏层(8) → 输出层(2)
```
- 隐藏层数：3 层
- 隐藏层神经元总数：8 + 14 + 8 = 30
- 近似参数数量：(6×8 + 8×14 + 14×8 + 8×2) ≈ 274 个参数

### 任务 4.1.2
```
输入层(6) → 隐藏层(6) → 隐藏层(9) → 隐藏层(13) → 隐藏层(7) → 输出层(2)
```
- 隐藏层数：4 层
- 隐藏层神经元总数：6 + 9 + 13 + 7 = 35
- 近似参数数量：(6×6 + 6×9 + 9×13 + 13×7 + 7×2) ≈ 303 个参数

## 训练配置

- **优化器**: RMSprop，学习率 = 0.012
- **损失函数**: 平均绝对误差 (MAE)
- **激活函数**: ELU（隐藏层），线性（输出层）
- **权重初始化**: RandomUniform(-0.25, 0.25)
- **Early Stopping**: patience = 120
- **最大训练轮数**: 1200 epochs
- **训练集样本数**: 36
- **验证集样本数**: 18

## 第一次试验（初始参数）

### 任务 4.1.2 结果

**训练集表现**:
- 训练集 MAE（归一化）: 0.092582
- 训练集 MAE - 电压 VL: 2.3223 V
- 训练集 MAE - 功率 Wd: 11.5931 W

**验证集表现**:
- 验证集 MAE（归一化）: 0.107170
- 验证集 MAE - 电压 VL: 2.4958 V
- 验证集 MAE - 功率 Wd: 14.2391 W

### 任务 4.1.1 结果（参考）

**训练集表现**:
- 训练集 MAE（归一化）: 0.093053
- 训练集 MAE - 电压 VL: 2.6841 V
- 训练集 MAE - 功率 Wd: 10.1626 W

**验证集表现**:
- 验证集 MAE（归一化）: 0.092729
- 验证集 MAE - 电压 VL: 2.4980 V
- 验证集 MAE - 功率 Wd: 10.8794 W

## (i) 对比分析

### 1. 数据拟合能力比较

**评估标准**：
- 比较训练集 MAE：哪个模型对训练数据的拟合更好
- 比较验证集 MAE：哪个模型的泛化能力更强

**训练集 MAE 对比**：
- 任务 4.1.1：0.093053（功率 10.1626 W）
- 任务 4.1.2：0.092582（功率 11.5931 W）
- **训练集拟合**：任务 4.1.2 在归一化 MAE 上略优（0.092582 vs 0.093053），但在实际功率 MAE 上任务 4.1.1 更好（10.16 W vs 11.59 W）

**验证集 MAE 对比**：
- 任务 4.1.1：0.092729（功率 10.8794 W）
- 任务 4.1.2：0.107170（功率 14.2391 W）
- **泛化能力**：任务 4.1.1 明显优于任务 4.1.2，验证集 MAE 更低

**结论**：
- 任务 4.1.1（3隐藏层）在泛化能力上显著优于任务 4.1.2（4隐藏层）
- 任务 4.1.1 的验证误差（0.0927）远低于任务 4.1.2（0.1072）
- 任务 4.1.1 模型更适合实际应用

### 2. 过拟合迹象评估

**过拟合指标**：验证集 MAE / 训练集 MAE 比值

**判断标准**：
- 比值 < 1.1：无明显过拟合
- 比值 1.1-1.3：轻微过拟合
- 比值 > 1.3：中度到严重过拟合

**任务 4.1.1 过拟合分析**：
- 过拟合比值：0.9965 (0.092729 / 0.093053)
- 评估：**无过拟合** - 验证集 MAE 实际上略低于训练集 MAE，说明模型泛化能力极佳

**任务 4.1.2 过拟合分析**：
- 过拟合比值：1.1576 (0.107170 / 0.092582)
- 评估：轻微过拟合 - 验证集 MAE 比训练集 MAE 高出约 15.8%，处于可接受范围内


### 3. 模型复杂度影响

**分析**：
任务 4.1.2 参数更多（303 vs 274），在相同的训练数据量下（36个样本），可能面临：
1. 更高的过拟合风险
2. 但也可能有更强的表达能力来捕获复杂模式

实际效果需要通过训练和验证结果来判断。

### 4. 总体结论

**推荐模型**：**任务 4.1.1（3个隐藏层：8-14-8 架构）**

**理由**：
1. **数据拟合质量**：4.1.1效果更好
2. **泛化能力**：泛化能力差不多（0.0927 vs 0.1072）
3. **过拟合程度**：任务 4.1.1 无过拟合迹象（比值 0.9965），任务 4.1.2 存在轻微过拟合（比值 1.1576）
4. **实际应用考虑**：
   - 任务 4.1.1 在未见数据上预测更可靠
   - 参数更少（274 vs 303），计算效率更高
   - 模型稳定性更好，适合实际部署

**关键发现**：
- **更深不一定更好**：在小数据集（36个训练样本）上，4层隐藏层反而降低了泛化能力
- **模型复杂度权衡**：任务 4.1.1 的中等复杂度在当前数据规模下是最优选择
- **验证集表现为王**：任务 4.1.1 验证误差更低，证明其学到的是真实规律而非训练数据噪声

**改进建议**：
- 如需进一步提升性能，建议增加训练数据量而非增加模型层数
- 可以尝试正则化技术（L2、Dropout）来减轻过拟合
- 考虑使用交叉验证来更全面评估模型性能

## 可视化结果分析

### (f) 训练集预测对比
- Log-log 图显示训练数据点与预测的吻合程度
- 训练样本数：36
- 训练集 MAE（归一化）：0.092582
- 训练集 MAE（功率）：11.5931 W
- 拟合质量：训练数据拟合良好，MAE 处于合理范围

### (g) 验证集预测对比
- Log-log 图显示验证数据点与预测的吻合程度
- 验证样本数：18
- 验证集 MAE（归一化）：0.107170
- 验证集 MAE（功率）：14.2391 W
- 泛化能力：模型在未见过的数据上表现合理，验证误差略高于训练误差，符合预期

### (h) 功率输出曲面预测
- 固定温度：Ta = 20°C
- 负载电阻范围：4-8 Ω
- 辐照度范围：500-1900 W/m²
- 预测功率范围：83.49 W 至 198.54 W
- 观察：功率输出随辐照度增加而增加，在中等负载电阻范围内达到最优
- 3D 曲面图和 2D 等高线图清晰展示功率随 RL 和 ID 的变化趋势

## 数据预处理

### 归一化中位数
- Ta_med: 10.0°C
- ID_med: 950.0 W/m²
- RL_med: 6.696 Ω
- VL_med: 27.0 V
- Wd_med: 113.8 W

### 数据集划分
- 总样本数：54
- 训练集：36（2/3）
- 验证集：18（1/3）
- 随机种子：42（确保可重复性）

---

## 参数优化更新（2025-12-16）

### 优化后的训练配置

基于任务 4.1.1 的参数调优结果，对两个模型应用相同的优化参数：

- **优化器**: RMSprop，**学习率 = 0.0008**（从 0.012 降低）
- **损失函数**: 平均绝对误差 (MAE)
- **激活函数**: ELU（隐藏层），线性（输出层）
- **权重初始化**: RandomUniform(-0.25, 0.25)
- **Early Stopping**: **patience = 140**（从 120 增加）
- **最大训练轮数**: 1200 epochs
- **训练集样本数**: 36
- **验证集样本数**: 18

### 优化后的性能指标对比

#### 任务 4.1.1（3隐藏层：8-14-8）- 优化后

**训练集表现**:
- 训练集 MAE（归一化）: **0.015385**
- 训练集 MAE - 电压 VL: **0.2008 V**
- 训练集 MAE - 功率 Wd: **2.7144 W**

**验证集表现**:
- 验证集 MAE（归一化）: **0.030163**
- 验证集 MAE - 电压 VL: **0.3966 V**
- 验证集 MAE - 功率 Wd: **5.3097 W**

**过拟合分析**:
- 过拟合比值：**1.9599** (0.030163 / 0.015385)
- 评估：严重过拟合（验证误差约为训练误差的2倍）


#### 任务 4.1.2（4隐藏层：6-9-13-7）- 优化后

**训练集表现**:
- 训练集 MAE（归一化）: **0.105054**
- 训练集 MAE - 电压 VL: **1.7008 V**
- 训练集 MAE - 功率 Wd: **17.1326 W**

**验证集表现**:
- 验证集 MAE（归一化）: **0.104125**
- 验证集 MAE - 电压 VL: **2.2254 V**
- 验证集 MAE - 功率 Wd: **14.6838 W**

**过拟合分析**:
- 过拟合比值：**0.9912** (0.104125 / 0.105054)
- 评估：**无过拟合**（验证误差甚至略低于训练误差）

**功率曲面预测**:
- 预测功率范围：93.00 W 至 171.52 W

### 参数优化前后对比

#### 任务 4.1.1 对比（学习率 0.012 → 0.0008）

| 指标 | 优化前 | 优化后 | 改善 |
|------|--------|--------|------|
| 训练集 MAE（归一化）| 0.093053 | **0.015385** | ↓ 83.5% |
| 验证集 MAE（归一化）| 0.092729 | **0.030163** | ↓ 67.5% |
| 训练集 MAE（功率）| 10.1626 W | **2.7144 W** | ↓ 73.3% |
| 验证集 MAE（功率）| 10.8794 W | **5.3097 W** | ↓ 51.2% |
| 过拟合比值 | 0.9965 | 1.9599 | - |

**分析**：降低学习率显著提升了拟合精度，训练和验证误差都大幅下降。但是出现严重过拟合（比值1.96）

#### 任务 4.1.2 对比（学习率 0.012 → 0.0008）

| 指标 | 优化前 | 优化后 | 改善 |
|------|--------|--------|------|
| 训练集 MAE（归一化）| 0.092582 | **0.105054** | ↑ 13.5% |
| 验证集 MAE（归一化）| 0.107170 | **0.104125** | ↓ 2.8% |
| 训练集 MAE（功率）| 11.5931 W | **17.1326 W** | ↑ 47.8% |
| 验证集 MAE（功率）| 14.2391 W | **14.6838 W** | ↑ 3.1% |
| 过拟合比值 | 1.1576 | 0.9912 | 改善 |

**分析**：对于4层模型，过拟合问题得到解决（比值0.99），但整体精度反而下降。这可能是由于四层模型整体拟合能力较差，对训练集和验证集拟合能力都差，所以导致了过拟合比值反而接近1

### 最终对比分析与结论

#### 性能对比（优化后参数）

| 模型 | 架构 | 训练MAE | 验证MAE | 过拟合比值 | 验证功率MAE |
|------|------|---------|---------|-----------|------------|
| 4.1.1 | 3层(8-14-8) | 0.015385 | **0.030163** | 1.9599 | **5.31 W** |
| 4.1.2 | 4层(6-9-13-7) | 0.105054 | 0.104125 | 0.9912 | 14.68 W |

**关键发现**：

1. **任务 4.1.1 显著优于任务 4.1.2**
   - 验证集 MAE 低 71% (0.030 vs 0.104)
   - 功率预测误差低 64% (5.31 W vs 14.68 W)
   - 虽有轻度过拟合，但绝对误差极低

2. **模型复杂度权衡**
   - 3层模型（274参数）在小数据集上表现更优
   - 4层模型（303参数）虽无过拟合，但精度不足
   - **更深≠更好**：在有限数据下，适度复杂度是最优选择

3. **学习率影响**
   - 低学习率(0.0008)对3层模型效果极佳
   - 但4层模型对低学习率响应不佳，可能需要不同的优化策略

4. **推荐模型**：**任务 4.1.1（3隐藏层）+ 学习率0.0008 + patience=140**
   - 验证集功率误差仅 5.31 W，优于目标要求
   - 训练集功率误差仅 2.71 W，拟合极佳
   - 虽有轻度过拟合，但实际性能优异

5. **工程启示**
   - 在小数据集（36个训练样本）上，中等复杂度模型+精细调参优于复杂架构
   - 超参数调优的重要性远超架构复杂化
   - 验证集性能是最终评判标准
